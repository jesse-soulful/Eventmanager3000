generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Category {
  id              String           @id @default(uuid())
  moduleType      String
  name            String
  description     String?
  color           String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  eventId         String?
  Event           Event?           @relation(fields: [eventId], references: [id], onDelete: Cascade)
  LineItem        LineItem[]
  SubLineItemType SubLineItemType[]

  @@unique([moduleType, name])
  @@index([eventId])
  @@index([moduleType])
}

model Event {
  id                  String            @id @default(uuid())
  name                String
  description         String?
  startDate           DateTime
  endDate             DateTime
  location            String?
  eventLink           String?
  ticketshopLink      String?
  venueName           String?
  venueAddress        String?
  venueCapacity       Int?
  promotorName        String?
  promotorPhone       String?
  artistLiaisonName   String?
  artistLiaisonPhone  String?
  technicalName       String?
  technicalPhone      String?
  runningOrder        String?
  bannerImageUrl      String?
  metadata            String?
  status              String            @default("DRAFT")
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  Category            Category[]
  LineItem            LineItem[]
  Status              Status[]
  SubLineItemType     SubLineItemType[]
  Tag                 Tag[]

  @@index([startDate])
  @@index([status])
}

model LineItem {
  id               String     @id @default(uuid())
  moduleType       String
  eventId          String
  name             String
  description      String?
  quantity         Float?
  unitPrice        Float?
  totalPrice       Float?
  plannedCost      Float?
  actualCost       Float?
  metadata         String?
  parentLineItemId String?
  statusId         String?
  categoryId       String?
  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt
  Category         Category?  @relation(fields: [categoryId], references: [id])
  Status           Status?    @relation(fields: [statusId], references: [id])
  LineItem         LineItem?  @relation("LineItemToLineItem", fields: [parentLineItemId], references: [id], onDelete: Cascade)
  other_LineItem   LineItem[] @relation("LineItemToLineItem")
  Event            Event      @relation(fields: [eventId], references: [id], onDelete: Cascade)
  Tag              Tag[]      @relation("LineItemTags")
  Comment          Comment[]

  @@index([parentLineItemId])
  @@index([categoryId])
  @@index([statusId])
  @@index([moduleType])
  @@index([eventId])
}

model Status {
  id         String     @id @default(uuid())
  moduleType String
  name       String
  color      String     @default("#6B7280")
  order      Int        @default(0)
  isDefault  Boolean    @default(false)
  itemType   String     @default("main")
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
  eventId    String?
  LineItem   LineItem[]
  Event      Event?     @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@unique([moduleType, itemType, name])
  @@index([eventId])
  @@index([moduleType, itemType])
}

model SubLineItemType {
  id          String    @id @default(uuid())
  moduleType  String
  eventId     String?
  categoryId  String?
  name        String
  description String?
  isDefault   Boolean   @default(false)
  order       Int       @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  event       Event?    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  category    Category? @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@unique([moduleType, categoryId, name])
  @@index([eventId])
  @@index([moduleType])
  @@index([categoryId])
}

model Tag {
  id         String     @id @default(uuid())
  moduleType String
  name       String
  color      String?
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
  eventId    String?
  Event      Event?     @relation(fields: [eventId], references: [id], onDelete: Cascade)
  LineItem   LineItem[] @relation("LineItemTags")

  @@unique([moduleType, name])
  @@index([eventId])
  @@index([moduleType])
}

model Comment {
  id          String    @id @default(uuid())
  lineItemId  String
  userId      String
  content     String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  LineItem   LineItem  @relation(fields: [lineItemId], references: [id], onDelete: Cascade)
  User        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([lineItemId])
  @@index([userId])
  @@index([createdAt])
}

// BetterAuth Models
model User {
  id            String    @id @default(uuid())
  name          String?
  email         String    @unique
  emailVerified Boolean   @default(false)
  image         String?
  password      String?
  role          String    @default("USER") // USER, ADMIN, VIEWER
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  accounts      Account[]
  sessions      Session[]
  comments      Comment[]

  @@index([email])
}

model Account {
  id                String  @id @default(uuid())
  userId            String
  accountId         String
  providerId        String
  accessToken       String?
  refreshToken      String?
  idToken           String?
  expiresAt         DateTime?
  password          String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([providerId, accountId])
  @@index([userId])
}

model Session {
  id        String   @id @default(uuid())
  userId    String
  expiresAt DateTime
  token     String   @unique
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([token])
  @@index([expiresAt])
}

model Verification {
  id         String   @id @default(uuid())
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([identifier, value])
  @@index([expiresAt])
}
