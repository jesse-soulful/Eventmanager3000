generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Category {
  id          String     @id
  moduleType  String
  name        String
  description String?
  color       String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime
  eventId     String?
  Event       Event?     @relation(fields: [eventId], references: [id], onDelete: Cascade)
  LineItem    LineItem[]

  @@unique([moduleType, name])
  @@index([eventId])
  @@index([moduleType])
}

model Event {
  id                  String            @id @default(uuid())
  name                String
  description         String?
  startDate           DateTime
  endDate             DateTime
  location            String?
  venueName           String?
  venueAddress        String?
  venueCapacity       Int?
  promotorName        String?
  promotorPhone       String?
  artistLiaisonName   String?
  artistLiaisonPhone  String?
  technicalName       String?
  technicalPhone      String?
  runningOrder        String?
  bannerImageUrl      String?
  metadata            String?
  status              String            @default("DRAFT")
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  Category            Category[]
  LineItem            LineItem[]
  Status              Status[]
  SubLineItemType     SubLineItemType[]
  Tag                 Tag[]

  @@index([startDate])
  @@index([status])
}

model LineItem {
  id               String     @id @default(uuid())
  moduleType       String
  eventId          String
  name             String
  description      String?
  quantity         Float?
  unitPrice        Float?
  totalPrice       Float?
  plannedCost      Float?
  actualCost       Float?
  metadata         String?
  parentLineItemId String?
  statusId         String?
  categoryId       String?
  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt
  Category         Category?  @relation(fields: [categoryId], references: [id])
  Status           Status?    @relation(fields: [statusId], references: [id])
  LineItem         LineItem?  @relation("LineItemToLineItem", fields: [parentLineItemId], references: [id], onDelete: Cascade)
  other_LineItem   LineItem[] @relation("LineItemToLineItem")
  Event            Event      @relation(fields: [eventId], references: [id], onDelete: Cascade)
  Tag              Tag[]      @relation("LineItemTags")
  Comment          Comment[]

  @@index([parentLineItemId])
  @@index([categoryId])
  @@index([statusId])
  @@index([moduleType])
  @@index([eventId])
}

model Status {
  id         String     @id
  moduleType String
  name       String
  color      String     @default("#6B7280")
  order      Int        @default(0)
  isDefault  Boolean    @default(false)
  itemType   String     @default("main")
  createdAt  DateTime   @default(now())
  updatedAt  DateTime
  eventId    String?
  LineItem   LineItem[]
  Event      Event?     @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@unique([moduleType, itemType, name])
  @@index([eventId])
  @@index([moduleType, itemType])
}

model SubLineItemType {
  id          String   @id @default(uuid())
  moduleType  String
  eventId     String?
  name        String
  description String?
  isDefault   Boolean  @default(false)
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  event       Event?   @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@unique([moduleType, name])
  @@index([eventId])
  @@index([moduleType])
}

model Tag {
  id         String     @id
  moduleType String
  name       String
  color      String?
  createdAt  DateTime   @default(now())
  updatedAt  DateTime
  eventId    String?
  Event      Event?     @relation(fields: [eventId], references: [id], onDelete: Cascade)
  LineItem   LineItem[] @relation("LineItemTags")

  @@unique([moduleType, name])
  @@index([eventId])
  @@index([moduleType])
}

model Comment {
  id          String    @id @default(uuid())
  lineItemId  String
  content     String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  LineItem   LineItem  @relation(fields: [lineItemId], references: [id], onDelete: Cascade)

  @@index([lineItemId])
  @@index([createdAt])
}
